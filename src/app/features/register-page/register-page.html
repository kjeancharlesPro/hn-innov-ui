<div
  class="relative flex min-h-screen w-full flex-col items-center bg-gradient-to-b from-[#1c122b] to-background-dark dark group/design-root overflow-x-hidden p-4 sm:p-6"
>
  <!-- Alertes en bas à droite (fixed) -->
  <div class="fixed bottom-6 right-6 z-50 max-w-sm space-y-3">
    <!-- Alerte succès -->
    <div
      *ngIf="success"
      class="w-full p-4 rounded-lg bg-gradient-to-br from-green-500/20 to-emerald-500/20 border border-green-500/30 flex items-start gap-4 shadow-lg shadow-green-500/20 animate-alert-fade-out"
    >
      <span class="material-symbols-outlined text-2xl text-green-400 mt-0.5 flex-shrink-0"
        >verified</span
      >
      <div class="flex-1">
        <h3 class="font-semibold text-green-300">Félicitations !</h3>
        <p class="text-sm text-green-300/80 mt-1">
          Votre inscription au hackathon a été enregistrée avec succès. Vous recevrez bientôt un
          e-mail de confirmation avec les prochaines étapes.
        </p>
      </div>
      <button
        (click)="closeAlert('success')"
        type="button"
        class="text-zinc-400 hover:text-white flex-shrink-0"
      >
        <span class="material-symbols-outlined text-base">close</span>
      </button>
    </div>

    <!-- Alerte erreur -->
    <div
      *ngIf="error"
      class="w-full p-4 rounded-lg bg-red-500/10 border border-red-500/30 flex items-start gap-3 shadow-lg shadow-red-500/20 animate-alert-fade-out"
    >
      <span class="material-symbols-outlined text-red-400 mt-0.5 flex-shrink-0">error</span>
      <div class="flex-1">
        <h3 class="font-semibold text-red-300">
          {{ submitted ? 'Erreur de validation' : 'Erreur' }}
        </h3>
        <p class="text-sm text-red-400/80 mt-1">
          {{ error }}
        </p>
      </div>
      <button
        (click)="closeAlert('error')"
        type="button"
        class="text-zinc-400 hover:text-white flex-shrink-0"
      >
        <span class="material-symbols-outlined text-base">close</span>
      </button>
    </div>
  </div>

  <main class="w-full max-w-md mx-auto flex flex-col items-center">
    <h2 class="text-white tracking-tight text-3xl font-bold leading-tight text-center pb-2 pt-4">
      Inscrivez-vous
    </h2>
    <p class="text-zinc-400 text-base font-normal leading-normal pb-8 text-center">
      Remplissez vos informations pour participer.
    </p>

    <form [formGroup]="form" (ngSubmit)="onSubmit()" class="w-full space-y-5">
      <div class="space-y-5">
        <div>
          <div class="grid grid-cols-2 gap-3">
            <label
              class="flex flex-col p-4 rounded-lg bg-zinc-900/50 border border-zinc-700 cursor-pointer has-[:checked]:border-primary has-[:checked]:ring-2 has-[:checked]:ring-primary/30 has-[:checked]:bg-primary/5"
            >
              <div class="flex items-center">
                <input
                  formControlName="role"
                  name="role"
                  type="radio"
                  value="participant"
                  class="form-radio"
                />
                <span class="ml-3 text-sm font-medium text-white">Participant</span>
              </div>
              <p class="text-xs text-white/60 mt-2 ml-7">
                Rejoignez une équipe et développez un prototype innovant en 48 heures
              </p>
            </label>
            <label
              class="flex flex-col p-4 rounded-lg bg-zinc-900/50 border border-zinc-700 cursor-pointer has-[:checked]:border-primary has-[:checked]:ring-2 has-[:checked]:ring-primary/30 has-[:checked]:bg-primary/5"
            >
              <div class="flex items-center">
                <input
                  formControlName="role"
                  name="role"
                  type="radio"
                  value="jury"
                  class="form-radio"
                />
                <span class="ml-3 text-sm font-medium text-white">Membre du jury</span>
              </div>
              <p class="text-xs text-white/60 mt-2 ml-7">
                Évaluez les projets et contribuez à la sélection des meilleures solutions
              </p>
            </label>
          </div>
        </div>

        <!-- Délimiteur -->
        <div class="border-t border-zinc-700/50"></div>
      </div>

      <div class="grid grid-cols-1 sm:grid-cols-2 gap-5">
        <label class="flex flex-col flex-1">
          <p class="text-zinc-300 text-sm font-medium leading-normal pb-2">Prénom</p>
          <input formControlName="firstName" [class.border-red-500]="isFieldInvalid('firstName')"
          [class.ring-red-500/30]="isFieldInvalid('firstName')" class="form-input flex w-full
          min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-white placeholder:text-zinc-500
          focus:outline-0 border border-zinc-700 bg-zinc-900/50 h-12 px-4 text-base font-normal
          leading-normal ring-2 ring-transparent focus:border-accent focus:ring-accent/30
          transition-colors" placeholder="Entrez votre prénom" />
          <p *ngIf="isFieldInvalid('firstName')" class="text-red-400 text-xs mt-1">
            Le prénom est requis
          </p>
        </label>

        <label class="flex flex-col flex-1">
          <p class="text-zinc-300 text-sm font-medium leading-normal pb-2">Nom</p>
          <input formControlName="lastName" [class.border-red-500]="isFieldInvalid('lastName')"
          [class.ring-red-500/30]="isFieldInvalid('lastName')" class="form-input flex w-full min-w-0
          flex-1 resize-none overflow-hidden rounded-lg text-white placeholder:text-zinc-500
          focus:outline-0 border border-zinc-700 bg-zinc-900/50 h-12 px-4 text-base font-normal
          leading-normal ring-2 ring-transparent focus:border-accent focus:ring-accent/30
          transition-colors" placeholder="Entrez votre nom" />
          <p *ngIf="isFieldInvalid('lastName')" class="text-red-400 text-xs mt-1">
            Le nom est requis
          </p>
        </label>
      </div>

      <label class="flex flex-col">
        <p class="text-zinc-300 text-sm font-medium leading-normal pb-2">Email</p>
        <input formControlName="email" type="email" [class.border-red-500]="isFieldInvalid('email')"
        [class.ring-red-500/30]="isFieldInvalid('email')" class="form-input flex w-full min-w-0
        flex-1 resize-none overflow-hidden rounded-lg text-white placeholder:text-zinc-500
        focus:outline-0 border border-zinc-700 bg-zinc-900/50 h-12 px-4 text-base font-normal
        leading-normal ring-2 ring-transparent focus:border-accent focus:ring-accent/30
        transition-colors" placeholder="Entrez votre email" />
        <p *ngIf="isFieldInvalid('email')" class="text-red-400 text-xs mt-1">
          {{ form.get('email')?.hasError('required') ? "L'email est requis" : 'Email invalide' }}
        </p>
      </label>

      <label class="flex flex-col">
        <p class="text-zinc-300 text-sm font-medium leading-normal pb-2">Confirmer l'email</p>
        <input formControlName="emailConfirm" type="email"
        [class.border-red-500]="isFieldInvalid('emailConfirm')"
        [class.ring-red-500/30]="isFieldInvalid('emailConfirm')" class="form-input flex w-full
        min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-white placeholder:text-zinc-500
        focus:outline-0 border border-zinc-700 bg-zinc-900/50 h-12 px-4 text-base font-normal
        leading-normal ring-2 ring-transparent focus:border-accent focus:ring-accent/30
        transition-colors" placeholder="Confirmez votre email" />
        <p *ngIf="isFieldInvalid('emailConfirm')" class="text-red-400 text-xs mt-1">
          {{
            form.get('emailConfirm')?.hasError('required')
              ? "La confirmation de l'email est requise"
              : 'Les emails ne correspondent pas'
          }}
        </p>
      </label>

      <div class="space-y-5">
        <!-- Délimiteur -->
        <div class="border-t border-zinc-700/50"></div>

        <!-- Option pour proposer une idée : visible uniquement si jury -->
        <div *ngIf="form.get('role')?.value === 'jury'">
          <p class="text-zinc-300 text-sm font-medium leading-normal pb-2">
            Que souhaitez-vous faire concernant la boîte à idées ?
          </p>
          <div class="grid grid-cols-1 gap-3">
            <label
              class="flex items-center p-3 h-12 rounded-lg bg-zinc-900/50 border border-zinc-700 cursor-pointer has-[:checked]:border-accent has-[:checked]:ring-2 has-[:checked]:ring-accent/30"
            >
              <input
                formControlName="hasIdea"
                name="hasIdea"
                type="radio"
                value="propose"
                class="form-radio"
              />
              <span class="ml-3 text-sm font-medium text-white">Proposer une idée</span>
            </label>
            <label
              class="flex items-center p-3 h-12 rounded-lg bg-zinc-900/50 border border-zinc-700 cursor-pointer has-[:checked]:border-accent has-[:checked]:ring-2 has-[:checked]:ring-accent/30"
            >
              <input
                formControlName="hasIdea"
                name="hasIdea"
                type="radio"
                value="adopt"
                class="form-radio"
              />
              <span class="ml-3 text-sm font-medium text-white">Présenter une idée existante</span>
            </label>
          </div>
        </div>

        <!-- Délimiteur -->
        <div *ngIf="form.get('role')?.value === 'jury'" class="border-t border-zinc-700/50"></div>

        <!-- Compétences : visible uniquement si participant -->
        <div *ngIf="form.get('role')?.value === 'participant'" class="space-y-5">
          <label class="flex flex-col">
            <p class="text-zinc-300 text-sm font-medium leading-normal pb-2">Compétences</p>
            <div class="relative">
              <select
                formControlName="skill"
                class="form-select appearance-none flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-white placeholder:text-zinc-500 focus:outline-0 border border-zinc-700 bg-zinc-900/50 h-12 px-4 text-base font-normal leading-normal ring-2 ring-transparent focus:border-accent focus:ring-accent/30 transition-colors"
              >
                <option disabled selected value="">Sélectionnez une compétence</option>
                <option value="Business Analyst">Business Analyst</option>
                <option value="Chef de projet">Chef de projet</option>
                <option value="Développeur">Développeur</option>
                <option value="Data Analyst">Data Analyst</option>
                <option value="Ingénieur production">Ingénieur production</option>
                <option value="Ingénieur commercial">Ingénieur commercial</option>
                <option value="Product Owner">Product Owner</option>
              </select>
            </div>
          </label>
        </div>

        <!-- S'approprier une idée : visible si hasIdea = 'adopt' ET role = 'jury' -->
        <div
          *ngIf="form.get('hasIdea')?.value === 'adopt' && form.get('role')?.value === 'jury'"
          class="space-y-5"
        >
          <label class="flex flex-col">
            <p class="text-zinc-300 text-sm font-medium leading-normal pb-2">
              Sélectionner une idée
            </p>
            <div class="relative">
              <select
                formControlName="selectedIssue"
                (change)="onIssueSelected($event)"
                class="form-select appearance-none flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-white placeholder:text-zinc-500 focus:outline-0 border border-zinc-700 bg-zinc-900/50 h-12 px-4 text-base font-normal leading-normal ring-2 ring-transparent focus:border-accent focus:ring-accent/30 transition-colors"
              >
                <option disabled selected value="">Choisissez une idée à vous approprier</option>
                <option *ngFor="let issue of availableSubject" [value]="issue.id">
                  {{ issue.title }}
                </option>
              </select>
            </div>
          </label>
          <!-- Card pour afficher les détails de l'idée sélectionnée -->
          <div
            *ngIf="selectedIssueDetails"
            class="rounded-xl bg-white/5 border border-white/10 p-6 space-y-4"
          >
            <div>
              <p class="text-zinc-400 text-xs font-medium uppercase tracking-wide mb-2">
                Titre du projet
              </p>
              <p class="text-white text-sm">{{ selectedIssueDetails.title }}</p>
            </div>
            <div class="border-t border-zinc-700/50"></div>
            <div>
              <p class="text-zinc-400 text-xs font-medium uppercase tracking-wide mb-2">
                Description du projet
              </p>
              <p class="text-white text-sm">{{ selectedIssueDetails.description }}</p>
            </div>
            <div class="border-t border-zinc-700/50"></div>
            <div>
              <p class="text-zinc-400 text-xs font-medium uppercase tracking-wide mb-2">
                Objectif du hackathon
              </p>
              <p class="text-white text-sm">{{ selectedIssueDetails.problem }}</p>
            </div>
            <div class="border-t border-zinc-700/50"></div>
            <div>
              <p class="text-zinc-400 text-xs font-medium uppercase tracking-wide mb-2">
                Innovation et originalité du projet
              </p>
              <p class="text-white text-sm">{{ selectedIssueDetails.innovation }}</p>
            </div>
          </div>
        </div>
        <div
          *ngIf="form.get('hasIdea')?.value === 'propose' && form.get('role')?.value === 'jury'"
          class="space-y-5"
        >
          <label class="flex flex-col">
            <p class="text-zinc-300 text-sm font-medium leading-normal pb-2">Titre du projet</p>
            <textarea
              formControlName="title"
              class="form-textarea flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-white placeholder:text-zinc-500 focus:outline-0 border border-zinc-700 bg-zinc-900/50 p-4 text-base font-normal leading-normal ring-2 ring-transparent focus:border-accent focus:ring-accent/30 transition-colors"
              placeholder="Un titre accrocheur et descriptif qui résume l'idée principale"
              rows="2"
            ></textarea>
          </label>

          <label class="flex flex-col">
            <p class="text-zinc-300 text-sm font-medium leading-normal pb-2">
              Description du projet
            </p>
            <textarea
              formControlName="description"
              class="form-textarea flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-white placeholder:text-zinc-500 focus:outline-0 border border-zinc-700 bg-zinc-900/50 p-4 text-base font-normal leading-normal ring-2 ring-transparent focus:border-accent focus:ring-accent/30 transition-colors"
              placeholder="Une brève description (100-200 mots) expliquant l'idée, son objectif et son utilité. Cette section doit donner une vue d'ensemble du projet"
              rows="3"
            ></textarea>
          </label>

          <label class="flex flex-col">
            <p class="text-zinc-300 text-sm font-medium leading-normal pb-2">Problème à résoudre</p>
            <textarea
              formControlName="problem"
              class="form-textarea flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-white placeholder:text-zinc-500 focus:outline-0 border border-zinc-700 bg-zinc-900/50 p-4 text-base font-normal leading-normal ring-2 ring-transparent focus:border-accent focus:ring-accent/30 transition-colors"
              placeholder="Décrire le problème ou le besoin que le projet vise à résoudre. Pourquoi ce projet est-il important ou pertinent ?"
              rows="3"
            ></textarea>
          </label>

          <label class="flex flex-col">
            <p class="text-zinc-300 text-sm font-medium leading-normal pb-2">
              Innovation et originalité
            </p>
            <textarea
              formControlName="innovation"
              class="form-textarea flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-white placeholder:text-zinc-500 focus:outline-0 border border-zinc-700 bg-zinc-900/50 p-4 text-base font-normal leading-normal ring-2 ring-transparent focus:border-accent focus:ring-accent/30 transition-colors"
              placeholder="Qu'est-ce qui rend ce projet unique ou innovant par rapport à ce qui existe déjà ?"
              rows="2"
            ></textarea>
          </label>
        </div>
      </div>

      <div class="pt-4">
        <button
          type="submit"
          [disabled]="loading"
          class="w-full bg-secondary h-14 px-6 rounded-lg bg-gradient-to-r from-primary to-accent text-white text-base font-bold shadow-lg shadow-accent/20 transition-transform duration-200 ease-in-out hover:scale-[1.02] active:scale-[0.98] disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
        >
          <span *ngIf="!loading">Soumettre</span>
          <span *ngIf="loading">Envoi en cours...</span>
          <span class="material-symbols-outlined">{{
            loading ? 'hourglass_top' : 'arrow_forward'
          }}</span>
        </button>
      </div>
    </form>

    <p class="text-center text-zinc-500 text-xs mt-8">
      En vous inscrivant, vous acceptez notre
      <a class="underline hover:text-accent" href="#">Politique de Confidentialité</a> et nos
      <a class="underline hover:text-accent" href="#">Conditions d'Utilisation</a>.
    </p>
  </main>
</div>
